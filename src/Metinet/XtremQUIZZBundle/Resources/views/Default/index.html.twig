{% extends '::base.html.twig' %}

{% block body %}
    {% set user = app.session.get('user') %}

    <div class="blockaccueil menu">
        <img src="{{ asset('/bundles/metinetxtremquizz/images/logo_xtremquizz.png') }}" id="logo"/>
        <ul class="menu">
            <li><a href="{{ path('admin') }}" class="lien-menu">Administration</a></li>
        </ul>
    </div>

    <div class="blockaccueil corps">
    <h3>Votre profil</h3>
    
    <table>
        <tr>
            <td class="width_100">
                <img src="https://graph.facebook.com/{{ user.fb_uid }}/picture?type=large&width=120&height=120"/>
            </td>
            <td style="padding-bottom: 83px;">
                <div class="titres-block">{{ user.firstname }} {{ user.lastname }}</div>
                Points: {{ points }} <br />
                    {% if classementJoueur == NULL %}
                         Classement général: {{ totalJoueur }}/{{ totalJoueur }}
                    {% else %}
                          Classement général: {{ classementJoueur }}/{{ totalJoueur }}
                    {% endif %}
                    <button onclick="publishWALL({{ classementJoueur }}, {{ totalJoueur }})">Publier</button>
            </td>
        </tr>
    </table>
    
    <h3 style="margin-top: 15px;">Les derniers quizz disponibles</h3>

    <p>
        Quizz 1<br />
        Quizz 2<br />
        Quizz 3<br />
        Quizz 4
    </p>
    
    <h3 style="margin-top: 15px;">Classement de vos amis</h3>
    <p>
    <table class="records_list">
        <thead>
            <tr>
                <th>Classement</th>
                <th>Prénom</th>
                <th>Nom</th>
                <th>Points</th>
                <th>Temps moyen</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
       {% for entity in entities %}
            {% for friend in friends %}
                {% if entity.fbUid == friend.id %}
                    <tr>
                        <td>{{ entity.rank }}</td>
                        <td>{{ entity.firstname }}</td>
                        <td>{{ entity.lastname }}</td>
                        <td>{{ entity.points }}</td>
                        <td>{{ entity.averageTime }}</td>
                        <td><button onclick="defierAmis({{ entity.fbUid }})">Inviter</button></td>
                    </tr>
                {% endif %}
           {% endfor %}
        {% endfor %}
        </tbody>
    </table>
    </p>
</div>
{% endblock %}
{% block javascripts %}
{{ parent() }}
    <script>
        function publishWALL(monClassement, total){
               FB.ui(
                {
                    method: 'feed',
                    name: 'XtremQUIZZ',
                    link: 'http://apps.facebook.com/xtremquizz-mamori',
                    caption: "XtremQUIZZ",
                    description: "Mon classement à XtremQUIZZ :"+ monClassement + "/" + total
                },
                function(response) {
                    if (response && response.post_id) {
                    } else {
                        alert('Erreur: Le message n’a pas été publié…');
                    }
                }
                );
        }
        function requestCallback(response) {
         // Handle callback here
        }
        function defierAmis(ID) {
            FB.ui({method: 'apprequests',
                message: "Oo C'est l'heure du dududu duel  ! oO",
                to: ID
            }, requestCallback);
        }
    </script>
{% endblock %}